---
import ThemeToggle from "@component/ThemeToggle.astro";
import { SECTIONS } from "@config/link";
---

<header class="hidden md:flex flex-col items-center fixed top-2 z-10">
  <nav class="flex gap-3 text-gray-900 dark:text-white rounded-full p-2">
    {
      SECTIONS.map(page => (
        <a href={`#${page.id}`} class="rounded-full px-4 py-2">
          {page.name}
        </a>
      ))
    }
  </nav>
</header>
<div class="fixed z-20 top-5 right-5">
  <ThemeToggle />
</div>
<script>
  // Smooth scrolling for hash links
  const selectClass = ["bg-primary-500", "font-bold", "text-white"];
  const links = document.querySelectorAll("header nav a");
  const sections = document.querySelectorAll("section");

  // Listen click event to scroll
  links.forEach(link => {
    link.addEventListener("click", function (e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute("href"));
      if (target) target.scrollIntoView({ behavior: "smooth" });
    });
  });

  // observe sections and update color on link
  const observer = new IntersectionObserver(
    entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          links.forEach(link => {
            if (link.getAttribute("href")?.includes(entry.target.id)) {
              link.classList.add(...selectClass);
            } else {
              link.classList.remove(...selectClass);
            }
          });
        }
      });
    },
    {
      threshold: 1
    }
  );

  sections.forEach(section => {
    observer.observe(section);
  });

  // Cleanup function
  document.onvisibilitychange = () => {
    if (document.visibilityState === "hidden") {
      observer.disconnect();
    } else {
      sections.forEach(section => {
        observer.observe(section);
      });
    }
  };
</script>
<style>
  nav {
    animation: nav-shadown 1s linear both;
    animation-timeline: scroll();
    animation-range: 0 100px;
  }

  @keyframes nav-shadown {
    to {
      @apply shadow-lg ring-1 backdrop-blur text-gray-900 bg-white/50 ring-white/10;
    }
  }
</style>
